<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <meta id="permission-tag" data-name="主页" data-class="系统" data-remark="主页,登陆后的页面框架"/>
    <link rel="stylesheet" href="../vendor/layui/css/layui.css">
    <link rel="stylesheet" href="../css/home/index.css">
    <!--suppress HtmlUnknownTarget -->
    <link rel="stylesheet" href="/css/utils/permissions-css.css">
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../js/home/index.js"></script>
    <script src="../vendor/md5/md5.js"></script>
    <style>
        body .layui-layer-iframe {
            width: 100%;
            left: 0;
        }
        .problem{
            cursor: pointer;
        }
    </style>

</head>

<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!--1.头部区域-->
    <div class="layui-header">
        <ul class="layui-nav layui-layout-left">
            <li>
                <a href="javascript:;" title="侧边伸缩" id="side_flexible">
                    <i class="layui-icon layui-icon-shrink-right"></i>
                </a>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item leftdaohang  " data-url="message.html" mytitle="问题反馈">
                <a href="https://qingflow.com/s/6e61916e">
                    <cite class="problem">问题反馈</cite>
                </a>
            </li>
            <li class="layui-nav-item leftdaohang permissions-elem " data-url="message.html" mytitle="消息中心">
                <a>
                    <i class="layui-icon layui-icon-notice"></i>
                    <span class="layui-badge all-notice-num">0</span>
                </a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <cite class="userName">未登录</cite>
                </a>
                <dl class="layui-nav-child">
                    <dd class="leftdaohang permissions-elem" data-url="set/user/info.html" mytitle="基本资料"><a>基本资料</a></dd>
                    <dd class="leftdaohang permissions-elem" data-url="set/user/password.html" mytitle="修改密码"><a>修改密码</a></dd>
                    <hr>
                    <dd data-href="login/login.html" class="logout" style="text-align: center; cursor: pointer">
                        <a>退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <!--2.左侧导航-->
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <div class="layui-logo leftdaohang permissions-elem" data-url="home/home2.html" mytitle="主页">
                <span>公司项目管理系统</span>
            </div>
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item">
                    <a>
                        <i class="layui-icon layui-icon-rate-solid"></i>
                        <span>项目管理</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd class="leftdaohang permissions-elem " style="display: none;" data-url="projectManagement/quote.html" mytitle="报价">
                            <a><span>报价</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="projectManagement/project.html" mytitle="项目">
                            <a><span>项目</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="projectManagement/implement.html" mytitle="实施">
                            <a><span>实施</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="projectManagement/workload.html" mytitle="工作量">
                            <a><span>工作量</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="projectManagement/data.html" mytitle="资料">
                            <a><span>资料</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="projectManagement/production.html" mytitle="生产费">
                            <a><span>生产费</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" style="display: none;" data-url="home/home1.html" mytitle="报表">
                            <a><span>报表</span></a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a>
                        <i class="layui-icon layui-icon-chart-screen"></i>
                        <span>经营管理</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd class="leftdaohang permissions-elem" data-url="operationManagement/contract.html" mytitle="合同">
                            <a><span>合同</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="operationManagement/management.html" mytitle="经营">
                            <a><span>经营</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="operationManagement/sche.html" mytitle="进度">
                            <a><span>进度</span></a>
                        </dd>
                        <dd class="leftdaohang" data-url="operationManagement/totalProject.html" mytitle="项目总计">
                            <a><span>项目总计</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="operationManagement/businessStatistics.html" mytitle="业务提成">
                            <a><span>业务提成</span></a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a>
                        <i class="layui-icon layui-icon-rmb"></i>
                        <span>财务管理</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd class="leftdaohang permissions-elem"  data-url="finance/disburseExpense.html" mytitle="报销">
                            <a><span>报销</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/borrowMoney.html" mytitle="借款">
                            <a><span>借款</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/transferAccounts.html" mytitle="转账">
                            <a><span>转账</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/invoice.html" mytitle="开票">
                            <a><span>开票</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/income.html" mytitle="回款">
                            <a><span>回款</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/financialDaily.html" mytitle="财务日常">
                            <a><span>财务日常</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/payment.html" mytitle="付款申请">
                            <a><span>付款申请</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/salary.html" mytitle="人员工资">
                            <a><span>人员工资</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/bankCardMoney.html" mytitle="银行账户余额">
                            <a><span>银行账户余额</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="finance/financialSummary.html" mytitle="财务汇总">
                            <a><span>财务汇总</span></a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item leftdaohang permissions-elem" data-url="message.html" mytitle="消息中心">
                    <a>
                        <i class="layui-icon layui-icon-notice"
                           style="text-align: left;color: rgba(255,255,255,.7);font-size: 14px;"></i>
                        <span>消息中心</span>
                    </a>
                </li>
                <li class="layui-nav-item" mytitle="设置">
                    <a>
                        <i class="layui-icon layui-icon-set"></i>
                        <span>设置</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd class="leftdaohang permissions-elem" data-url="set/flow.html" mytitle="流程管理">
                            <a><span>流程管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/structure.html" mytitle="组织架构">
                            <a><span>组织架构</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/role.html" mytitle="角色管理">
                            <a><span>角色管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/user.html" mytitle="用户管理">
                            <a><span>用户管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/permission.html" mytitle="权限管理">
                            <a><span>权限管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/financeSet.html" mytitle="财务管理">
                            <a><span>财务管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/WorkSet.html" mytitle="工作管理">
                            <a><span>工作量管理</span></a>
                        </dd>
                        <dd class="leftdaohang" data-url="set/teamManageTab.html" mytitle="生产费管理">
                            <a><span>生产费管理</span></a>
                        </dd>
                        <dd class="leftdaohang permissions-elem" data-url="set/refereesAndPartnerSet.html" mytitle="合作伙伴">
                            <a><span>合作伙伴</span></a>
                        </dd>
                    </dl>
                    <dl class="layui-nav-child">
                        <dd class="layui-nav-itemed">
                            <a href="javascript:">我的设置</a>
                            <dl class="layui-nav-child">
                                <dd class="leftdaohang permissions-elem" data-url="set/user/info.html" mytitle="基本资料"><a>基本资料</a></dd>
                                <dd class="leftdaohang permissions-elem" data-url="set/user/password.html" mytitle="修改密码"><a>修改密码</a>
                                </dd>
                            </dl>
                        </dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <!--3.右侧主体内容区-->
    <div class="layui-body" id="nav_xbs_tab">
        <!--tabs标签-->
        <div class="layui-tab layui-tab-card" lay-filter="demo" lay-allowclose="true">
            <ul class="layui-tab-title" id="demo">
            </ul>
            <div class="layui-tab-content">
            </div>
        </div>
    </div>
</div>
<script src="../vendor/layui/layui.all.js"></script>

<script>
    // 1 初始化layui的Tab的切换功能
    layui.use('element', function () {
        var $ = layui.jquery, element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        //触发事件
        var active = {
            tabAdd: function () {
                //新增一个Tab项
                var htmlurl = $(this).attr('data-url');
                var mytitle = $(this).attr('mytitle');
                //                  alert("触发tab增加事件："+mytitle);
                //先判断是否已经有了tab
                var arrayObj = new Array();　//创建一个数组
                $(".layui-tab-title").find('li').each(function () {
                    var y = $(this).attr("lay-id"); //lay-id="角色管理"
                    arrayObj.push(y);
                });
                //                    alert("遍历取到的数组："+arrayObj);
                var have = $.inArray(mytitle, arrayObj);  //返回 3,
                if (have >= 0) {
                    //tab已有标签
                    //                        alert("遍历的已有标签："+mytitle);
                    element.tabChange('demo', mytitle); //切换到当前点击的页面
                } else {
                    //没有相同tab
                    //                      alert("遍历的没有相同tab："+mytitle);
                    element.tabAdd('demo', {
                        title: mytitle //用于演示
                        ,
                        content: '<iframe  style="width: 100%;height:calc(100% - 10px);"  frameborder="0"  scrolling="no"  src=' + htmlurl + '  onload="iframeLoad(this)" ></iframe>'
                        ,
                        id: mytitle //实际使用一般是规定好的id，这里以时间戳模拟下
                    });
                    element.tabChange('demo', mytitle); //切换到当前点击的页面
                }
            }

        };
        $(".leftdaohang").click(function () {
            var type = "tabAdd";
            var othis = $(this);
            active[type] ? active[type].call(this, othis) : '';
        });

    });

    // 2 让iframe的高度自适应
    function iframeLoad(thisA) {
        $(thisA).height($(thisA).contents().find("html").height());
    }

    //  3 页面一加载触发了点击事件,点击首页,使得首页为展开状态
    $("[data-url='home/home2.html']").trigger("click");

    //  4 点击tab导航栏时,侧边导航栏样式相应改变
    $(document).on('click', '.layui-tab-title li', function () {
        var lay_id = $(this).attr('lay-id');
        var tree = $(".layui-nav-tree [mytitle='" + lay_id + "']");
        tree.addClass("layui-this").siblings().removeClass("layui-this");
        tree.siblings().find('dd').removeClass("layui-this");
        tree.closest('li').siblings().removeClass("layui-this");
        tree.closest('li').siblings().find('dd').removeClass("layui-this");
    });

    // 5 选项卡右键关闭刷新
    layui.config({
        base: '../vendor/layui/js/',
    }).use(['element', 'tabrightmenu'], function () {
        let element = layui.element;
        let rightmenu_ = layui.tabrightmenu;

        // 默认方式渲染全部：关闭当前（closethis）、关闭所有（closeall）、关闭其它（closeothers）、关闭左侧所有（closeleft）、关闭右侧所有（closeright）、刷新当前页（refresh）
        rightmenu_.render({
            container: '#nav_xbs_tab',
            filter: 'demo',
            navArr: [
                {eventName: 'refresh', title: '刷新当前页'},
                // { eventName: 'closethis', title: '关闭当前页' },
                // { eventName: 'closeall', title: '关闭所有页' },
                {eventName: 'closeothers', title: '关闭其它页'},
                {eventName: 'closeleftbutpin', title: '关闭左侧标签'},
                {eventName: 'closerightbutpin', title: '关闭右侧标签'}
            ]
        });
    });


</script>

</body>

</html>
